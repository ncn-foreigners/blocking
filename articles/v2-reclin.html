<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="blocking">
<title>Blocking records for record linkage • blocking</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Blocking records for record linkage">
<meta property="og:description" content="blocking">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">blocking</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/v1-deduplication.html">Blocking records for deduplication</a>
    <a class="dropdown-item" href="../articles/v2-reclin.html">Blocking records for record linkage</a>
    <a class="dropdown-item" href="../articles/v3-evaluation.html">Evaluation of blocking procedures</a>
    <a class="dropdown-item" href="../articles/v4-integration.html">Integration with existing packages</a>
    <a class="dropdown-item" href="../articles/v5-bigdata.html">Dealing with large datasets</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ncn-foreigners/blocking/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Blocking records for record linkage</h1>
                        <h4 data-toc-skip class="author">Maciej
Beręsewicz</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ncn-foreigners/blocking/blob/HEAD/vignettes/v2-reclin.Rmd" class="external-link"><code>vignettes/v2-reclin.Rmd</code></a></small>
      <div class="d-none name"><code>v2-reclin.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Read required packages</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ncn-foreigners/blocking" class="external-link">blocking</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/djvanderlaan/reclin2" class="external-link">reclin2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: data.table</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>Read the example data from the tutorial on <a href="https://github.com/djvanderlaan/tutorial-reclin-uros2021" class="external-link">the
<code>reclin</code> package on the URos 2021 Conference</a>. The data
sets are from ESSnet on Data Integration as stated in the
repository:</p>
<pre><code>These totally fictional data sets are supposed to have captured details of
persons up to the date 31 December 2011.  Any years of birth captured as 2012
are therefore in error.  Note that in the fictional Census data set, dates of
birth between 27 March 2011 and 31 December 2011 are not necessarily in error.

Census: A fictional data set to represent some observations from a
        decennial Census
CIS: Fictional observations from Customer Information System, which is
        combined administrative data from the tax and benefit systems

In the dataset census all records contain a person_id. For some of the records
in cis the person_id is also available. This information can be used to
evaluate the linkage (assuming these records from the cis are representable 
all records in the cis). </code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">census</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/djvanderlaan/tutorial-reclin-uros2021/main/data/census.csv"</span><span class="op">)</span></span>
<span><span class="va">cis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/djvanderlaan/tutorial-reclin-uros2021/main/data/cis.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">census</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">cis</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>
<code>census</code> object has 25343 rows and 9,</li>
<li>
<code>cis</code> object has 25343 rows and 9.</li>
</ul>
<p>Census data</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">census</span><span class="op">)</span></span>
<span><span class="co">#&gt;       person_id pername1 pername2    sex dob_day dob_mon dob_year</span></span>
<span><span class="co">#&gt;          &lt;char&gt;   &lt;char&gt;   &lt;char&gt; &lt;char&gt;   &lt;int&gt;   &lt;int&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1: DE03US001001    COUIE    PRICE      M       1       6     1960</span></span>
<span><span class="co">#&gt; 2: DE03US001002    ABBIE    PVICE      F       9      11     1961</span></span>
<span><span class="co">#&gt; 3: DE03US001003    LACEY    PRICE      F       7       2     1999</span></span>
<span><span class="co">#&gt; 4: DE03US001004   SAMUEL    PRICE      M      13       4     1990</span></span>
<span><span class="co">#&gt; 5: DE03US001005   JOSEPH    PRICE      M      20       4     1986</span></span>
<span><span class="co">#&gt; 6: DE03US001006     JOSH    PRICE      M      14       2     1996</span></span>
<span><span class="co">#&gt;           enumcap enumpc</span></span>
<span><span class="co">#&gt;            &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: 1 WINDSOR ROAD DE03US</span></span>
<span><span class="co">#&gt; 2: 1 WINDSOR ROAD DE03US</span></span>
<span><span class="co">#&gt; 3: 1 WINDSOR ROAD DE03US</span></span>
<span><span class="co">#&gt; 4: 1 WINDSOR ROAD DE03US</span></span>
<span><span class="co">#&gt; 5: 1 WINDSOR ROAD DE03US</span></span>
<span><span class="co">#&gt; 6: 1 WINDSOR ROAD DE03US</span></span></code></pre></div>
<p>CIS data</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cis</span><span class="op">)</span></span>
<span><span class="co">#&gt;    person_id pername1 pername2    sex dob_day dob_mon dob_year</span></span>
<span><span class="co">#&gt;       &lt;char&gt;   &lt;char&gt;   &lt;char&gt; &lt;char&gt;   &lt;int&gt;   &lt;int&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:      &lt;NA&gt;   HAYDEN     HALL      M      NA       1       NA</span></span>
<span><span class="co">#&gt; 2:      &lt;NA&gt;    SEREN ANDERSON      F       1       1       NA</span></span>
<span><span class="co">#&gt; 3:      &lt;NA&gt;    LEWIS    LEWIS      M       1       1       NA</span></span>
<span><span class="co">#&gt; 4:      &lt;NA&gt; HARRISON   POSTER      M       5       1       NA</span></span>
<span><span class="co">#&gt; 5:      &lt;NA&gt; MUHAMMED   WATSUN      M       7       1       NA</span></span>
<span><span class="co">#&gt; 6:      &lt;NA&gt;     RHYS THOMPSON      M       7       1       NA</span></span>
<span><span class="co">#&gt;               enumcap  enumpc</span></span>
<span><span class="co">#&gt;                &lt;char&gt;  &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:   91 CLARENCE ROAD PO827ER</span></span>
<span><span class="co">#&gt; 2:     24 CHURCH LANE LS992DB</span></span>
<span><span class="co">#&gt; 3:     53 CHURCH ROAD  M432ZZ</span></span>
<span><span class="co">#&gt; 4:  19 HIGHFIELD ROAD  SW75TG</span></span>
<span><span class="co">#&gt; 5: 17 VICTORIA STREET        </span></span>
<span><span class="co">#&gt; 6: 1 SPRINGFIELD ROAD SW540RB</span></span></code></pre></div>
<p>We need to create new columns that concatanates variables from
<code>pername1</code> to <code>enumpc</code>. In the first step we
replace <code>NA</code>s with <code>''</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">census</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dob_day</span><span class="op">)</span>, <span class="va">dob_day</span> <span class="op">:=</span> <span class="st">""</span><span class="op">]</span></span>
<span><span class="co">#&gt; Warning in `[.data.table`(census, is.na(dob_day), `:=`(dob_day, "")): Coercing</span></span>
<span><span class="co">#&gt; 'character' RHS to 'integer' to match the type of column 5 named 'dob_day'.</span></span>
<span><span class="va">census</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dob_mon</span><span class="op">)</span>, <span class="va">dob_mon</span> <span class="op">:=</span> <span class="st">""</span><span class="op">]</span></span>
<span><span class="va">census</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dob_year</span><span class="op">)</span>, <span class="va">dob_year</span> <span class="op">:=</span> <span class="st">""</span><span class="op">]</span></span>
<span><span class="co">#&gt; Warning in `[.data.table`(census, is.na(dob_year), `:=`(dob_year, "")):</span></span>
<span><span class="co">#&gt; Coercing 'character' RHS to 'integer' to match the type of column 7 named</span></span>
<span><span class="co">#&gt; 'dob_year'.</span></span>
<span><span class="va">cis</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dob_day</span><span class="op">)</span>, <span class="va">dob_day</span> <span class="op">:=</span> <span class="st">""</span><span class="op">]</span></span>
<span><span class="co">#&gt; Warning in `[.data.table`(cis, is.na(dob_day), `:=`(dob_day, "")): Coercing</span></span>
<span><span class="co">#&gt; 'character' RHS to 'integer' to match the type of column 5 named 'dob_day'.</span></span>
<span><span class="va">cis</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dob_mon</span><span class="op">)</span>, <span class="va">dob_mon</span> <span class="op">:=</span> <span class="st">""</span><span class="op">]</span></span>
<span><span class="va">cis</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dob_year</span><span class="op">)</span>, <span class="va">dob_year</span> <span class="op">:=</span> <span class="st">""</span><span class="op">]</span></span>
<span><span class="co">#&gt; Warning in `[.data.table`(cis, is.na(dob_year), `:=`(dob_year, "")): Coercing</span></span>
<span><span class="co">#&gt; 'character' RHS to 'integer' to match the type of column 7 named 'dob_year'.</span></span>
<span></span>
<span><span class="va">census</span><span class="op">[</span>, <span class="va">txt</span><span class="op">:=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">pername1</span>, <span class="va">pername2</span>, <span class="va">sex</span>, <span class="va">dob_day</span>, <span class="va">dob_mon</span>, <span class="va">dob_year</span>, <span class="va">enumcap</span>, <span class="va">enumpc</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">cis</span><span class="op">[</span>, <span class="va">txt</span><span class="op">:=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">pername1</span>, <span class="va">pername2</span>, <span class="va">sex</span>, <span class="va">dob_day</span>, <span class="va">dob_mon</span>, <span class="va">dob_year</span>, <span class="va">enumcap</span>, <span class="va">enumpc</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="linking-datasets">Linking datasets<a class="anchor" aria-label="anchor" href="#linking-datasets"></a>
</h2>
<div class="section level3">
<h3 id="using-basic-functionalities-of-blocking-package">Using basic functionalities of <code>blocking</code> package<a class="anchor" aria-label="anchor" href="#using-basic-functionalities-of-blocking-package"></a>
</h3>
<p>The goal of this exercise is to link units from the CIS dataset to
the CENSUS dataset.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blocking.html">blocking</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">census</span><span class="op">$</span><span class="va">txt</span>, y <span class="op">=</span> <span class="va">cis</span><span class="op">$</span><span class="va">txt</span>, verbose <span class="op">=</span> <span class="fl">1</span>, seed <span class="op">=</span> <span class="fl">2024</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== creating tokens =====</span></span>
<span><span class="co">#&gt; ===== starting search (nnd, x, y: 25343, 24613, t: 1079) =====</span></span>
<span><span class="co">#&gt; ===== creating graph =====</span></span></code></pre></div>
<p>Distribution of distances for pairs</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">result1</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">dist</span>, main <span class="op">=</span> <span class="st">"Distribution of distances between pairs"</span>, xlab <span class="op">=</span> <span class="st">"Distances"</span><span class="op">)</span></span></code></pre></div>
<p><img src="v2-reclin_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Example pairs</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result1</span><span class="op">$</span><span class="va">result</span>, n<span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;         x     y block       dist</span></span>
<span><span class="co">#&gt;     &lt;int&gt; &lt;int&gt; &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:     3 20590 17979 0.01290381</span></span>
<span><span class="co">#&gt;  2:     4 18456 16292 0.07158586</span></span>
<span><span class="co">#&gt;  3:     5 17257 15354 0.05370842</span></span>
<span><span class="co">#&gt;  4:     6 19868 17425 0.05675775</span></span>
<span><span class="co">#&gt;  5:     7 11183 10246 0.00000000</span></span>
<span><span class="co">#&gt;  6:    10  9370  8668 0.08233700</span></span>
<span><span class="co">#&gt;  7:    10  9785  8668 0.66230919</span></span>
<span><span class="co">#&gt;  8:    11  7247  6794 0.04881026</span></span>
<span><span class="co">#&gt;  9:    11  7249  6794 0.39135537</span></span>
<span><span class="co">#&gt; 10:    13  5852  5555 0.00000000</span></span></code></pre></div>
<p>Let’s look at the first pair. Clearly there is a typo on the
<code>pername1</code> but all other variables are the same so it seems
that this is a match.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">census</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;       person_id pername1 pername2    sex dob_day dob_mon dob_year</span></span>
<span><span class="co">#&gt;          &lt;char&gt;   &lt;char&gt;   &lt;char&gt; &lt;char&gt;   &lt;int&gt;   &lt;int&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1: DE03US001001    COUIE    PRICE      M       1       6     1960</span></span>
<span><span class="co">#&gt;           enumcap enumpc                                   txt</span></span>
<span><span class="co">#&gt;            &lt;char&gt; &lt;char&gt;                                &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: 1 WINDSOR ROAD DE03US COUIEPRICEM1619601 WINDSOR ROADDE03US</span></span>
<span><span class="va">cis</span><span class="op">[</span><span class="fl">8152</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;    person_id pername1 pername2    sex dob_day dob_mon dob_year        enumcap</span></span>
<span><span class="co">#&gt;       &lt;char&gt;   &lt;char&gt;   &lt;char&gt; &lt;char&gt;   &lt;int&gt;   &lt;int&gt;    &lt;int&gt;         &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:      &lt;NA&gt;    LOUIE    PRICE      M       1       6     1960 1 WINDSOR ROAD</span></span>
<span><span class="co">#&gt;    enumpc                                   txt</span></span>
<span><span class="co">#&gt;    &lt;char&gt;                                &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: DE03US LOUIEPRICEM1619601 WINDSOR ROADDE03US</span></span></code></pre></div>
<p>Now, let’s look at the 7th pair with the largest distance from the
first 10 rows. This seems to be a non-match because only
<code>pername2</code> and <code>sex</code> are the same.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">census</span><span class="op">[</span><span class="fl">8</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;       person_id pername1 pername2    sex dob_day dob_mon dob_year</span></span>
<span><span class="co">#&gt;          &lt;char&gt;   &lt;char&gt;   &lt;char&gt; &lt;char&gt;   &lt;int&gt;   &lt;int&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1: DE03US003001   NATMAN  RUSSELL      M      11      11     1934</span></span>
<span><span class="co">#&gt;           enumcap enumpc                                        txt</span></span>
<span><span class="co">#&gt;            &lt;char&gt; &lt;char&gt;                                     &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: 3 WINDSOR ROAD DE03US NATMANRUSSELLM111119343 WINDSOR ROADDE03US</span></span>
<span><span class="va">cis</span><span class="op">[</span><span class="fl">3901</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;    person_id pername1 pername2    sex dob_day dob_mon dob_year      enumcap</span></span>
<span><span class="co">#&gt;       &lt;char&gt;   &lt;char&gt;   &lt;char&gt; &lt;char&gt;   &lt;int&gt;   &lt;int&gt;    &lt;int&gt;       &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:      &lt;NA&gt;    AYAAN  RUSSELL      M      10      10     1943 112 KINGSWAY</span></span>
<span><span class="co">#&gt;     enumpc                                      txt</span></span>
<span><span class="co">#&gt;     &lt;char&gt;                                   &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: SO879UN AYAANRUSSELLM10101943112 KINGSWAYSO879UN</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="assessing-the-quality">Assessing the quality<a class="anchor" aria-label="anchor" href="#assessing-the-quality"></a>
</h3>
<p>For some records we have information on the correct linkage. We can
use this information to assess our approach.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">census</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>x<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">.N</span>, <span class="va">person_id</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                 y <span class="op">=</span> <span class="va">cis</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">.N</span>, <span class="va">person_id</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                 by <span class="op">=</span> <span class="st">"person_id"</span><span class="op">)</span></span>
<span><span class="va">matches</span><span class="op">[</span>, <span class="va">block</span><span class="op">:=</span><span class="fl">1</span><span class="op">:</span><span class="va">.N</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">matches</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;person_id&gt;</span></span>
<span><span class="co">#&gt;        person_id     x     y block</span></span>
<span><span class="co">#&gt;           &lt;char&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:  DE03US012003    20 21256     1</span></span>
<span><span class="co">#&gt; 2:  DE03US015002    35  9524     2</span></span>
<span><span class="co">#&gt; 3:  DE03US019002    44  6754     3</span></span>
<span><span class="co">#&gt; 4:  DE03UT043001    81 17312     4</span></span>
<span><span class="co">#&gt; 5: DE125LU002001    98 12386     5</span></span>
<span><span class="co">#&gt; 6: DE125LU016001   126 11309     6</span></span></code></pre></div>
<p>So in our example we have 971 pairs.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blocking.html">blocking</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">census</span><span class="op">$</span><span class="va">txt</span>, y <span class="op">=</span> <span class="va">cis</span><span class="op">$</span><span class="va">txt</span>, verbose <span class="op">=</span> <span class="fl">1</span>, seed <span class="op">=</span> <span class="fl">2024</span>,</span>
<span>                    true_blocks <span class="op">=</span> <span class="va">matches</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">block</span><span class="op">)</span><span class="op">]</span>, n_threads <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== creating tokens =====</span></span>
<span><span class="co">#&gt; ===== starting search (nnd, x, y: 25343, 24613, t: 1079) =====</span></span>
<span><span class="co">#&gt; ===== creating graph =====</span></span></code></pre></div>
<p>Let’s see how our approach handled this problem.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result2</span></span>
<span><span class="co">#&gt; ========================================================</span></span>
<span><span class="co">#&gt; Blocking based on the nnd method.</span></span>
<span><span class="co">#&gt; Number of blocks: 21390.</span></span>
<span><span class="co">#&gt; Number of columns used for blocking: 1079.</span></span>
<span><span class="co">#&gt; Reduction ratio: 1.</span></span>
<span><span class="co">#&gt; ========================================================</span></span>
<span><span class="co">#&gt; Distribution of the size of the blocks:</span></span>
<span><span class="co">#&gt;     2     3     4     5 </span></span>
<span><span class="co">#&gt; 18472  2638   255    25 </span></span>
<span><span class="co">#&gt; ========================================================</span></span>
<span><span class="co">#&gt; Evaluation metrics (standard):</span></span>
<span><span class="co">#&gt;      recall   precision         fpr         fnr    accuracy specificity </span></span>
<span><span class="co">#&gt;     85.1699     84.1302      0.0063     14.8301     99.9879     99.9937</span></span></code></pre></div>
<p>It seems that default parameters of the NND method result in FNR of
16% which is quite large. Let’s compare to HNSW algorithm.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blocking.html">blocking</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">census</span><span class="op">$</span><span class="va">txt</span>, y <span class="op">=</span> <span class="va">cis</span><span class="op">$</span><span class="va">txt</span>, seed <span class="op">=</span> <span class="fl">2024</span>, verbose <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                    true_blocks <span class="op">=</span> <span class="va">matches</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">block</span><span class="op">)</span><span class="op">]</span>, n_threads <span class="op">=</span> <span class="fl">4</span>, </span>
<span>                    ann <span class="op">=</span> <span class="st">"hnsw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===== creating tokens =====</span></span>
<span><span class="co">#&gt; ===== starting search (hnsw, x, y: 25343, 24613, t: 1079) =====</span></span>
<span><span class="co">#&gt; ===== creating graph =====</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result3</span></span>
<span><span class="co">#&gt; ========================================================</span></span>
<span><span class="co">#&gt; Blocking based on the hnsw method.</span></span>
<span><span class="co">#&gt; Number of blocks: 23985.</span></span>
<span><span class="co">#&gt; Number of columns used for blocking: 1079.</span></span>
<span><span class="co">#&gt; Reduction ratio: 1.</span></span>
<span><span class="co">#&gt; ========================================================</span></span>
<span><span class="co">#&gt; Distribution of the size of the blocks:</span></span>
<span><span class="co">#&gt;     2     3     4     5 </span></span>
<span><span class="co">#&gt; 23373   597    14     1 </span></span>
<span><span class="co">#&gt; ========================================================</span></span>
<span><span class="co">#&gt; Evaluation metrics (standard):</span></span>
<span><span class="co">#&gt;      recall   precision         fpr         fnr    accuracy specificity </span></span>
<span><span class="co">#&gt;     99.3821     99.3821      0.0003      0.6179     99.9994     99.9997</span></span></code></pre></div>
<p>It seems that the HNSW algorithm performed better with 0.62% FNR.
This however comes with cost, in particupar computational cost:</p>
<ol style="list-style-type: decimal">
<li>the HNSW does not handle sparse matrices so sparse matrix of tokens
is converted to dense.</li>
<li>HNSW algorithm is slower than NND.</li>
</ol>
<p>Computational times are: 16 seconds for NND and about 60 HNSW (on M2
MacBook AIR).</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Maciej Beręsewicz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
